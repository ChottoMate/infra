name: Trivy Security Scan ğŸ›¡ï¸

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:
  trivy-scan:
    name: Trivy IaC Scan
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code ğŸ“¥
        uses: actions/checkout@v3

      - name: Run Trivy vulnerability scanner ğŸ•µï¸â€â™‚ï¸
        uses: aquasecurity/trivy-action@master
        with:
          scan-type: 'config'        # Terraformãªã©ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã™ã‚‹ãƒ¢ãƒ¼ãƒ‰
          hide-progress: false       # ãƒ­ã‚°ã‚’ã‚¹ãƒƒã‚­ãƒªã•ã›ã‚‹ã‹
          exit-code: '1'             # è„†å¼±æ€§ãŒè¦‹ã¤ã‹ã£ãŸã‚‰CIã‚’ã€Œå¤±æ•—(Red)ã€ã«ã™ã‚‹è¨­å®šï¼ˆè¶…é‡è¦ï¼ï¼‰
          ignore-unfixed: true       # ä¿®æ­£ãƒ‘ãƒƒãƒãŒãªã„ã‚„ã¤ã¯ç„¡è¦–ï¼ˆãƒã‚¤ã‚ºæ¸›ã‚‰ã—ï¼‰
          severity: 'CRITICAL,HIGH'  # ã€Œãƒ¤ãƒã„ï¼ˆCriticalï¼‰ã€ã¨ã€Œé«˜ã„ï¼ˆHighï¼‰ã€ã ã‘æ¤œçŸ¥ã™ã‚‹